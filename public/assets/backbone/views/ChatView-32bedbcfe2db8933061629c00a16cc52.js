((function(){TownHall140.Views.ChatView=Backbone.View.extend({initialize:function(){return app.get("pusher").bind("chat",$.proxy(this.onChatNew,this)),$(".submit",this.el).click($.proxy(this.onSubmitClick,this)),$("input",this.el).keypress($.proxy(this.onInputKey,this))},template:JST["backbone/templates/chat"],onSubmitClick:function(){return this.postMessage($("input",this.el).val())},onInputKey:function(a){if(a.keyCode===13)return this.postMessage($("input",this.el).val())},onChatNew:function(a){var b;return b=$(".messages",this.el),b.append(this.template(a)),b.prop({scrollTop:b.prop("scrollHeight")})},postMessage:function(a){var b;b=app.get("show").id;if(a!=="")return $.ajax({type:"post",url:"/shows/"+b+"/chats",data:{message:a},error:function(a){return $(document).trigger("loginRequired")}}),$("input",this.el).val("")}})})).call(this)